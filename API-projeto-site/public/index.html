<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site pessoal</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/loading.css">

</head>

<body class="toLoad">
    <section id="loadScreen">
        <%- include('load.html'); %>
    </section>


    <div class="content-holder">

        <div class="side-menu">
            <div class="profileIcon">
                <div class="icon">
                    <img id="summonerIcon" src="" alt="">
                    <div id="level" class="level"></div>
                </div>
                <div id="username">
                </div>
            </div>
        </div>

        <div class="content">
            <div class="profile-home">
                <div class="history-container">

                </div>
            </div>

        </div>

    </div>


    <!-- 
    <section class="mainContent">
        <div class="principal-bg">

            <div class="slogan">
                <h1 class="title red">Summoner's Guide</h1>

            </div>
        </div>
    </section> -->
    <!-- <section class="loreSection">
        <h1 class="title">O que é League of Legends?</h1>
        <p class="loreDesc">League of Legends é um jogo de estratégia em que duas equipes de cinco poderosos Campeões se
            enfrentam para destruir a
            base uma da outra. Escolha entre mais de 140 Campeões para realizar jogadas épicas, assegurar abates e
            destruir torres
            conforme você luta até a vitória.
        </p>
    </section> -->

    <script src="./js/main.js"></script>
    <script>

        let pageContent = document.querySelector('.page-content')
        let user = sessionStorage.getItem('user');
        user = JSON.parse(user);

        username.innerHTML = user.name;
        level.innerHTML = user.summonerLevel;





        let icon = document.querySelector('#summonerIcon');
        icon.src = `http://ddragon.leagueoflegends.com/cdn/11.10.1/img/profileicon/${user.profileIconId}.png`;



        let accId = user.accountId;
        let matchList = {}
        let history = []



        // fillUserHistory = () => {
        //     if (historyFilled == true) {


        //         history.forEach(match => {
        //             let inMatchId;
        //             let newJson = {
        //                 championId: match.championId,
        //                 gameDuration: match.gameDuration,
        //                 gameMode: match.gameMode,
        //                 gameType: match.gameType,
        //                 data: {},

        //             }

        //             match.participantIdentities.forEach((participant) => {
        //                 if (user.accountId == participant.player.accountId) {
        //                     inMatchId = participant.participantId;
        //                 }
        //             })

        //             match.participants.forEach(player => {
        //                 if (player.participantId == inMatchId) {
        //                     newJson.data = player;
        //                     userHistory.push(newJson);

        //                 }
        //             })

        //         })

        //     }
        // }

        getMatchList = async () => {
            fetch(`summoner/getMatchList/${accId}`, {
                method: 'GET',
            }).then((response) => {
                if (response.ok) {
                    response.json().then(async (data) => {
                        matchList = data;
                        await matchList.matches.splice(20, (matchList.matches.length - 1));

                        matchList.matches.forEach(match => {
                            let newJson = {
                                championId: match.champion,
                                gameId: match.gameId,
                                lane: match.lane,
                                role: match.role,
                                timestamp: match.timestamp,
                                gameDuration: '',
                                queueId: '',
                                gameMode: '',
                                gameType: '',
                                teams: [],
                                participants: [],
                                participantIdentities: [],
                                data: [],
                            }

                            fetch(`summoner/getMatch/${match.gameId}`, {
                                method: 'GET'
                            }).then((response) => {
                                if (response.ok) {
                                    response.json().then(async (data) => {
                                        let inMatchId;
                                        newJson.gameDuration = data.gameDuration;
                                        newJson.queueId = data.queueId;
                                        newJson.gameMode = data.gameMode;
                                        newJson.gameType = data.gameType;
                                        newJson.teams = data.teams;
                                        newJson.participants = data.participants;
                                        newJson.participantIdentities = data.participantIdentities;

                                        newJson.participantIdentities.forEach((participant) => {
                                            if (user.accountId == participant.player.accountId) {
                                                inMatchId = participant.participantId;
                                            }
                                        })

                                        newJson.participants.forEach(player => {
                                            if (player.participantId == inMatchId) {
                                                newJson.data = player;
                                            }
                                        })


                                        await history.push(newJson);

                                    })
                                } else {
                                    console.log(response.statusText);
                                }
                            }).catch((error) => {
                                console.log(error);
                            })

                        })
                    });
                } else {
                    console.log(response.statusText)
                }
            }).catch((error) => {
                console.log(error);
            });
        }
        getMatchList();






    </script>
</body>

</html>